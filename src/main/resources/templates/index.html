<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<title>Spring News</title>
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<link rel="stylesheet" href="nav.css"/>
	<link rel="stylesheet" href="style1.css"/>
	<script src="/poll.js"></script>
	<script src="/script.js"></script>
</head>
<body>
	<nav>
		<ul>
			<li><h1><a th:href="@{/}"><span>Spring</span>News</a></h1></li>
			<li id="input"><input type="search" oninput="search(this)" placeholder="Search news"/></li>
			<script>
				// <![CDATA[
					function search(s){
					    var key = s.value.toLowerCase();
					    var x = document.getElementsByClassName("content");
					    var y = document.getElementsByTagName("h2");
					    if(key == ''){
					    	for(var i = 0; i < x.length; i++){
						    		x[i].parentNode.style.display = "block";
						    }
					    	return
					    }
					    for(var i = 0; i < x.length; i++){
					    	if(x[i].innerHTML.toLowerCase().search(key) == -1 &&
					    			y[i].innerHTML.toLowerCase().search(key) == -1)
					    		x[i].parentNode.style.display = "none";
					    	else
					    		x[i].parentNode.style.display = "block";
					    }
					}
				// ]]>
				</script>
			<div>
				<li sec:authorize="isAuthenticated()"><a th:href="@{/create}">Add</a></li>
				<li><a href="/login" sec:authorize="isAnonymous()">Log in</a></li>
				<li><a href="/logout" sec:authorize="isAuthenticated()">Log out</a></li>
				<li id="name" sec:authorize="isAuthenticated()">Logged in as: <span th:text="${name}"></span></li>
			</div>
		</ul>
	</nav>
	<main id="main">
		<div class="news" th:each="news : ${news}">
			<h2 th:text="${news.title}"></h2>	
			<p class="content" id="cont" th:text="${news.content}"></p>
			<div>
				<button th:if="${news.author == name || name == 'admin'}" class="rbtn" onclick="remove(this)" sec:authorize="isAuthenticated()" th:value="${news.id}">Remove</button>
				<script>
				// <![CDATA[
					function remove(btn){
					    var xhttp = new XMLHttpRequest();
					    var val = btn.value;
					    xhttp.open("GET", "/remove/" + val, true);
					    xhttp.send(); 		
					}
				// ]]>
				</script>
				<span class="datetime">
					<p>Published:</p>
					<p th:text="${news.date}"></p>
					<p th:text="${news.time}"></p>
					<p th:text="'by ' + ${news.author}"></p>
				</span>	
				<span id="votes">
					<p><span th:id="'vote' + ${news.id}" th:text="${news.votes}"></span></p>
					<button  class="ubtns" th:id="'ubtn' + ${news.id}" sec:authorize="hasRole('USER')" th:value="${news.id}" onclick="upvote(this)" th:style="${news.color == 1} ? 'background-color: #00ce02; color: white' : ''">Upvote</button>
					<button  class="dbtns" th:id="'dbtn' + ${news.id}" sec:authorize="hasRole('USER')" th:value="${news.id}" onclick="downvote(this)" th:style="${news.color == -1} ? 'background-color: red; color: white' : ''">Downvote</button>
				</span>
			</div>
			<div class="clear"></div>
		</div>
	</main>
</body>
</html>